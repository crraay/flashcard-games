<div class="fill-blank-container">
  <button class="back-button" (click)="goBack()" type="button">
    ‚Üê Back to Game Selection
  </button>

  <div *ngIf="selectedSet && !gameComplete" class="game-header">
    <h2 class="game-title">{{ selectedSet.name }}</h2>
    <div class="game-stats">
      <span class="stat">Word {{ currentQuestionIndex + 1 }}/{{ questions.length }}</span>
      <span class="stat">Score: {{ score }}/{{ questions.length }}</span>
    </div>
  </div>

  <fg-game-completion
    *ngIf="gameComplete"
    title="üéâ Game Complete! üéâ"
    [message]="getCompletionMessage()"
    (restart)="restartGame()">
  </fg-game-completion>

  <div *ngIf="selectedSet && !gameComplete && getCurrentQuestion()" class="game-content">
    <div class="word-image">
      <img [src]="getCurrentQuestion()!.flashcard.imageUrl" [alt]="getCurrentQuestion()!.flashcard.caption" />
    </div>

    <div class="instructions">
      <h3>Fill in the missing letters!</h3>
    </div>

    <div class="blank-pattern">
      <div class="pattern-display">
        <span
          *ngFor="let char of getCurrentQuestion()!.blankPattern.split(''); let i = index"
          class="pattern-char"
          [class.letter]="char !== '_'"
          [class.blank]="char === '_'">
          <span *ngIf="char !== '_'">{{ char }}</span>
          <span 
            *ngIf="char === '_'" 
            class="blank-slot"
            [class.incorrect]="isLetterIncorrect(i)"
            [class.correct]="isLetterCorrect(i)">
            {{ getSelectedLetterForPosition(i) || '_' }}
          </span>
        </span>
      </div>
    </div>

    <div class="letter-options-area">
      <div
        *ngFor="let option of getCurrentQuestion()!.blankOptions; let blankIndex = index"
        class="blank-options-group">
        <div class="options-label">Choose letter for position {{ blankIndex + 1 }}:</div>
        <div class="options-grid">
          <button
            *ngFor="let letter of availableLetters[option.position]; let optionIndex = index"
            class="letter-option-button"
            [class.selected]="getSelectedLetterForPosition(option.position) === letter"
            [class.disabled]="showResult"
            (click)="selectLetter(letter, option.position, optionIndex)"
            type="button">
            {{ letter }}
          </button>
        </div>
      </div>
    </div>

    <div *ngIf="showResult && isCorrect" class="actions">
      <button class="continue-button" (click)="nextQuestion()" type="button">
        {{ currentQuestionIndex + 1 < questions.length ? 'Continue' : 'Finish Game' }}
      </button>
    </div>
  </div>
</div>
